#!/usr/bin/env bash

set -oue pipefail

# Run setup
echo 'Running initial setup...'

mkdir -p "$XDG_CONFIG_HOME/config.d"

# Install oh-my-zsh
ZSH="$XDG_CONFIG_HOME/oh-my-zsh" sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended

# Spaceship theme
ZSH_CUSTOM="$XDG_CONFIG_HOME/oh-my-zsh/custom"
git clone https://github.com/denysdovhan/spaceship-prompt.git "$ZSH_CUSTOM/themes/spaceship-prompt" --depth=1
ln -s "$ZSH_CUSTOM/themes/spaceship-prompt/spaceship.zsh-theme" "$ZSH_CUSTOM/themes/spaceship.zsh-theme"
sed -i 's/^ZSH_THEME="robbyrussell"/ZSH_THEME="spaceship"/' "$XDG_CONFIG_HOME/.zshrc"

# nvm
nvm_setup='[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion'

echo "$nvm_setup" >> "$XDG_CONFIG_HOME/.zshrc"

git clone https://github.com/nvm-sh/nvm.git "$NVM_DIR"
cd "$NVM_DIR"
git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" $(git rev-list --tags --max-count=1)`
\. "$NVM_DIR/nvm.sh"

nvm install 8 ; nvm install 12
nvm install 14 ; npm install -g npm@7
nvm install 18 ; nvm alias default 18

# pyenv
git clone https://github.com/pyenv/pyenv.git "$PYENV_ROOT"
git clone https://github.com/pyenv/pyenv-virtualenv.git "$PYENV_ROOT/plugins/pyenv-virtualenv"

echo '[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"' >> "$XDG_CONFIG_HOME/.zshrc"
echo 'eval "$(pyenv init -)"' >> "$XDG_CONFIG_HOME/.zshrc"

"$PYENV_ROOT/bin/pyenv" install 3.10.13; "$PYENV_ROOT/bin/pyenv" install 2.7.18
"$PYENV_ROOT/bin/pyenv" virtualenv 2.7.18 local2
"$PYENV_ROOT/bin/pyenv" global 3.10.13 local2

