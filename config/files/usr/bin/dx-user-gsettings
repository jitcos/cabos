#!/usr/bin/env bash

# SCRIPT VERSION
USER_SETUP_VER=2
USER_SETUP_VER_FILE="${XDG_DATA_HOME:-$HOME/.local/share}/cabos/gsettings-configured"
USER_SETUP_VER_RAN=$(cat "$USER_SETUP_VER_FILE")

mkdir -p "$(dirname "$USER_SETUP_VER_FILE")" || exit 1

## Backup in case local.d config doesn't take for whatever reason

# Run script if updated
if [[ -f $USER_SETUP_VER_FILE && "$USER_SETUP_VER" = "$USER_SETUP_VER_RAN" ]]; then
  echo "GSettings setup v$USER_SETUP_VER has already run. Exiting..."
  exit 0
fi

gsettings set org.gnome.shell favorite-apps "['org.mozilla.firefox.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Software.desktop', 'org.gnome.Terminal.desktop', 'code.desktop']"
gsettings set org.gnome.shell enabled-extensions "['hide-universal-access@akiirui.github.io', 'dash-to-panel@jderose9.github.com', 'blur-my-shell@aunetx', 'gsconnect@andyholmes.github.io', 'appindicatorsupport@rgcjonas.gmail.com', 's76-scheduler@mattjakeman.com', 'caffeine@patapon.info', 'start-overlay-in-application-view@Hex_cz', 'workspace-switch-wraparound@theychx.org', 'disable-workspace-animation@ethnarque', 'disable-workspace-switcher-overlay@cleardevice', 'background-logo@fedorahosted.org']"

gsettings set org.gnome.mutter workspaces-only-on-primary false
gsettings set org.gnome.mutter dynamic-workspaces false

gsettings set org.gnome.desktop.interface gtk-enable-primary-paste false
gsettings set org.gnome.desktop.interface enable-hot-corners false

gsettings set org.gnome.desktop.wm.preferences button-layout ":minimize,maximize,close"
gsettings set org.gnome.desktop.wm.preferences num-workspaces 4

gsettings set org.gnome.desktop.wm.keybindings switch-to-workspace-left "['<Alt>Left']"
gsettings set org.gnome.desktop.wm.keybindings switch-to-workspace-right "['<Alt>Right']"

gsettings set org.gnome.desktop.peripherals.touchpad two-finger-scrolling-enabled true
gsettings set org.gnome.desktop.peripherals.touchpad natural-scroll false
gsettings set org.gnome.desktop.peripherals.touchpad tap-to-click true

gsettings set org.gnome.desktop.background picture-options zoom
gsettings set org.gnome.desktop.background picture-uri 'file:///usr/share/backgrounds/RockyMountain/RockyMountain1.jpg'
gsettings set org.gnome.desktop.background picture-uri-dark 'file:///usr/share/backgrounds/RockyMountain/RockyMountain2.jpg'
gsettings set org.gnome.desktop.background primary-color '7FC1CA'
gsettings set org.gnome.desktop.background secondary-color '000000'

gsettings set org.gnome.desktop.interface text-scaling-factor 1.5

gsettings set org.gnome.software allow-updates false
gsettings set org.gnome.software download-updates false
gsettings set org.gnome.software download-updates-notify false
gsettings set org.gnome.software packaging-format-preference "['flatpak:flathub-user']"

gsettings set org.gnome.settings-daemon.plugins.media-keys next "['<Alt>period']"
gsettings set org.gnome.settings-daemon.plugins.media-keys play "['<Alt>slash']"
gsettings set org.gnome.settings-daemon.plugins.media-keys previous "['<Alt>comma']"

gsettings set org.gnome.settings-daemon.plugins.color night-light-enabled true

gsettings set org.gnome.mutter experimental-features "['scale-monitor-framebuffer']"

gsettings set org.gnome.shell.extensions.gsconnect enabled false

gsettings set org.gnome.shell.extensions.dash-to-panel hide-overview-on-startup true
gsettings set org.gnome.shell.extensions.dash-to-panel isolate-workspaces true

gsettings set org.gnome.shell.app-switcher current-workspace-only true

# Terminal theme
PROFILE_UUID=$(uuidgen)

gsettings set org.gnome.Terminal.ProfilesList list "$(gsettings get org.gnome.Terminal.ProfilesList list | sed "s/]/, '$PROFILE_UUID']/")"

dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/audible-bell" false
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/background-color" "'#3C3C4C4C5555'"
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/bold-color-same-as-fg" true
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/font" "'FiraMono Nerd Font 12'"
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/foreground-color" "'#C5C5D4D4DDDD'"
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/palette" "['rgb(60, 76, 85)', 'rgb(223, 140, 140)', 'rgb(168, 206, 147)', 'rgb(218, 218, 147)', 'rgb(131, 175, 229)', 'rgb(154, 147, 225)', 'rgb(127, 193, 202)', 'rgb(197, 212, 221)', 'rgb(137, 155, 166)', 'rgb(242, 195, 143)', 'rgb(168, 206, 147)', 'rgb(218, 218, 147)', 'rgb(131, 175, 229)', 'rgb(209, 142, 194)', 'rgb(127, 193, 202)', 'rgb(230, 238, 243)']"
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/use-system-font" false
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/use-theme-colors" false
dconf write "/org/gnome/terminal/legacy/profiles:/:$PROFILE_UUID/visible-name" "'Lucid'"

gsettings set org.gnome.Terminal.ProfilesList default "'$PROFILE_UUID'"

# Prevent future executions
echo "Writing state file"
echo "$USER_SETUP_VER" > "$USER_SETUP_VER_FILE"